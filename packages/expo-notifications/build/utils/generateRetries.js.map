{"version":3,"file":"generateRetries.js","sourceRoot":"","sources":["../../src/utils/generateRetries.ts"],"names":[],"mappings":"AAAA,MAAM,aAAa,GAAG,GAAG,CAAC,CAAC,SAAS;AACpC,MAAM,aAAa,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,YAAY;AACjD,MAAM,kBAAkB,GAAG,CAAC,CAAC;AAE7B,MAAM,CAAC,OAAO,CAAC,KAAK,SAAS,CAAC,CAAC,eAAe,CAC5C,IAA0C,EAC1C,OAGC;IAED,MAAM,YAAY,GAAG,OAAO,EAAE,YAAY,IAAI,aAAa,CAAC;IAC5D,MAAM,YAAY,GAAG,OAAO,EAAE,YAAY,IAAI,aAAa,CAAC;IAE5D,IAAI,KAAK,GAAG,YAAY,CAAC;IACzB,IAAI,SAAS,GAAG,IAAI,CAAC;IACrB,OAAO,SAAS,EAAE;QAChB,SAAS,GAAG,KAAK,CAAC;QAClB,MAAM,MAAM,GAAG,MAAM,MAAM,IAAI,CAAC,GAAG,EAAE;YACnC,SAAS,GAAG,IAAI,CAAC;QACnB,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,EAAE;YACd,OAAO,MAAM,CAAC;SACf;aAAM;YACL,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC;YACzD,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,GAAG,kBAAkB,CAAC,CAAC;SAC5D;KACF;AACH,CAAC","sourcesContent":["const INITIAL_DELAY = 500; // 500 ms\nconst MAXIMUM_DELAY = 2 * 60 * 1000; // 2 minutes\nconst EXPONENTIAL_FACTOR = 2;\n\nexport default async function* generateRetries(\n  func: (retry: () => void) => Promise<void>,\n  options?: {\n    initialDelay?: number;\n    maximumDelay?: number;\n  }\n) {\n  const initialDelay = options?.initialDelay ?? INITIAL_DELAY;\n  const maximumDelay = options?.maximumDelay ?? MAXIMUM_DELAY;\n\n  let delay = initialDelay;\n  let shouldTry = true;\n  while (shouldTry) {\n    shouldTry = false;\n    const result = yield await func(() => {\n      shouldTry = true;\n    });\n    if (!shouldTry) {\n      return result;\n    } else {\n      await new Promise(resolve => setTimeout(resolve, delay));\n      delay = Math.min(maximumDelay, delay * EXPONENTIAL_FACTOR);\n    }\n  }\n}\n"]}